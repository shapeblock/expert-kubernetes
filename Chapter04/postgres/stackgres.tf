resource "kubernetes_namespace" "stackgres" {
  lifecycle {
    ignore_changes = [metadata]
  }

  metadata {
    name = "stackgres"
  }
}

resource "time_sleep" "wait_30_seconds" {
  depends_on       = [kubernetes_namespace.stackgres]
  destroy_duration = "30s"
}

resource "helm_release" "stackgres" {
  repository = "https://stackgres.io/downloads/stackgres-k8s/stackgres/helm"
  chart      = "stackgres-operator"
  name       = "stackgres-operator"
  namespace  = "stackgres"
  timeout    = 600
  depends_on = [time_sleep.wait_30_seconds]
  version    = "1.2.0-beta1"

  set {
    name  = "adminui.service.type"
    value = "LoadBalancer"
  }
  set {
    name  = "cert.key"
    value = "LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRQ3RtbjFCZ3ZXZ1lZV3gKcDFlVkNyMXZPRTZIbjZuOG5VSGNQNjRGSXJGRURMTUdtNnlwS2hSd2F2VXYwMHkyR1ZXbk9URWdESFhCRVdkUApkcHd3N2hnODl1K095TG9oWjdlN1AzM0Nma1Q3N3FQcUhBeHd3NmZWeU1iS1FuOENGbkx5UVAxaFVjbXhELy8vCmNlSWpiaHFvdzQzY1Y1UWlGQTl4a1FtZ1U3RlgxZ2ppa3I1ZktuRGh5SnAzWjVLQUNHbFAwN1cwYjlsRHJWbHEKVDlZbG1rMTViY2hUWW5jTUlyQXhTVEFQZlIzL1QxMVNLbzlSbnIyaS9FYXNISDkwbnBBOGVtYWFMK1pFVTZOVgpiTzJhSHkrQUFvQXZueTJ1Q2svQmNmVkZZWG12UGE5d0JNY1FVTUhVZmVHS0dwc3o2ak4xVVZWOURRWWF1bDZyCjFlRnhsYnpoQWdNQkFBRUNnZ0VBTlduSENCVUhCZVY3Z1FGL3pQZVUrVmRWc2h6SjdGTm1KQ0hqcE9qYnFaaE8Kck1YUkJldFFocFlpQWlqOC9Ub21SR0V3WUMvMU93WGp4MnN5KzBzR1lodUg4V0tKQWlZclBZMTNZQlFCblpINwpGTmkwYXkySHdoc1lMcnJ1NFBHUFJFSUNzNks2YjZRQW05T3FSRVJvSjJ5amhSdmRFKzhnSVUwQ3JUV1M1dmNOCjN2MTdlK1BqblB1TEZrOVVYcWdTeFhBeVpxZkpJdUx0S2FHUXk1c3RSYysvdVA1WXd6T3dqb2ZZb3VnMXF1bkYKcUd1cExOWC8vTEsyRTlpa0NlSXUvZXlTZzVudkNLbTRQeHRiZXM4U0ZFNkJiMk9obnRyQXJ6UUUzLy92YzUzZwpFbjZRREcxdjZ0cHZuMGJXMkdwT3RSUE9oelJ1SlY4Y1ltTVhwZENiQVFLQmdRRFdIbzErMm10cmZFU3BmZEpYCnByVXdZQzlZYjcySDNSZmlBcnhUZ01MZDlyQzMzOElER1RYaGZJSlk2Y2YyVmNaUDhNRCtnODRab3dDelNhUnoKTWdoNUprUVRuRWd0MndrSTg4RjF2YmtXNnRaUE1KaDE2QkZHOG9sWGVGRmNNUytYOHEreWFhS2RPN3JPdHhjbgpHR1JWcy9rUm93alhidU1YM2JhYitYUHBhUUtCZ1FEUGp6YTdEcnVzK0tWb0kvVGZRc3dFdGg0TE4zY09ZaDAxCjFmN3dCRkNsRXlkdnRsU0NXZytMNWNjYTI0MkpWSWZnZ3NLcnFZUGxiUHNWVzY0aVJLUGtaMFN3dkhCL2N5OUYKR3Z2dFpieHF0U2lxUzBvbFNDMVk2MzJxU3lYMWlBcmxkb3R3QmdodWlLODhpKytlK25LN1lmRDU3RnpJVWNraQo3dFZhL1crUXVRS0JnUUNzbU53K0VScmQvY0hyVGowcjRublRrUFVaT0pseTEwblZLWmRkU0VITVlucDQvYW1LCmpkdmM4MXl2QjJQa3NhZTE4TC9oYWFYTkRKUVg4WmphTXM2WnVick9nLys2MXdFbGNqZlVEU2NSemlNS21vV0wKSlpJbnVvSHpQRTE1SHp6YUl3cDFxcWttVFd0OERpSmZwVTNidDhOaDhDWEVZdUl6N3Npd1doaVJZUUtCZ0F6QwpsQzNKeVJYb0wxc0lvdHc2NGdvRUhESzZWVEpvSzcyTWkyQzhFeTBpMFZEWDE3Z3Z5emJoaUcwSlJGbEYvaGg2ClVYZDJNMnFlV1kxRmxwMzZ0RXl0WUphdzd3V1cwamdnWVk2RnE2Q3Z4SEU3c2JJN0RyYWh1NWNGaWE3Zmp6UHUKSnNKYlRKZG5CY2JtSDNRWmw0WVhqbFgvQnZFMXZmVE0xQWNFLzUvWkFvR0JBSno3NS9VVlVCd0liNzdYMWZxQwpwNTc3V1dFRnR6S3IvSjluVjNTQVJzdzU5Q2J0b2xuZFRIODFmZFNvR1U4MFlJSmFmSlBlYnJaTHQ5NTM4Nnl3CmRpTmZMOGFBWXpod1dQWmJSZkFMSXdUTFo0ODRIdEx0bEpvQW5CblB0MjN5TzdTekJkaDdNY3NEWW9YS1g5TkYKWUE0VjBKTSs5dDM0dUg4WTRJdG5uemdaCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K"
  }
  set {
    name  = "cert.crt"
    value = "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQxVENDQXIyZ0F3SUJBZ0lVQVNBTi9sU1JVZ3hsZGtLQ3NPTlB4NXUvd3ZVd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0ZURVRNQkVHQTFVRUF4TUthM1ZpWlhKdVpYUmxjekFlRncweU1qQTFNRGN3TkRFME1EQmFGdzB5TXpBMQpNRGN3TkRFME1EQmFNQ2N4SlRBakJnTlZCQU1USEhOMFlXTnJaM0psY3kxdmNHVnlZWFJ2Y2k1emRHRmphMmR5ClpYTXdnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDdG1uMUJndldnWVlXeHAxZVYKQ3Ixdk9FNkhuNm44blVIY1A2NEZJckZFRExNR202eXBLaFJ3YXZVdjAweTJHVlduT1RFZ0RIWEJFV2RQZHB3dwo3aGc4OXUrT3lMb2haN2U3UDMzQ2ZrVDc3cVBxSEF4d3c2ZlZ5TWJLUW44Q0ZuTHlRUDFoVWNteEQvLy9jZUlqCmJocW93NDNjVjVRaUZBOXhrUW1nVTdGWDFnamlrcjVmS25EaHlKcDNaNUtBQ0dsUDA3VzBiOWxEclZscVQ5WWwKbWsxNWJjaFRZbmNNSXJBeFNUQVBmUjMvVDExU0tvOVJucjJpL0Vhc0hIOTBucEE4ZW1hYUwrWkVVNk5WYk8yYQpIeStBQW9Bdm55MnVDay9CY2ZWRllYbXZQYTl3Qk1jUVVNSFVmZUdLR3BzejZqTjFVVlY5RFFZYXVsNnIxZUZ4CmxiemhBZ01CQUFHamdnRUpNSUlCQlRBT0JnTlZIUThCQWY4RUJBTUNCYUF3RXdZRFZSMGxCQXd3Q2dZSUt3WUIKQlFVSEF3RXdEQVlEVlIwVEFRSC9CQUl3QURBZEJnTlZIUTRFRmdRVSs2NFBXb3BQVDNML3lERGQ0OHZId2gydwpMNDR3SHdZRFZSMGpCQmd3Rm9BVXAybU1FZjlEQXFSdWttWnp3VmFFMUxIdEg1Z3dnWThHQTFVZEVRU0JoekNCCmhJSVNjM1JoWTJ0bmNtVnpMVzl3WlhKaGRHOXlnaHh6ZEdGamEyZHlaWE10YjNCbGNtRjBiM0l1YzNSaFkydG4KY21WemdpQnpkR0ZqYTJkeVpYTXRiM0JsY21GMGIzSXVjM1JoWTJ0bmNtVnpMbk4yWTRJdWMzUmhZMnRuY21WegpMVzl3WlhKaGRHOXlMbk4wWVdOclozSmxjeTV6ZG1NdVkyeDFjM1JsY2k1c2IyTmhiREFOQmdrcWhraUc5dzBCCkFRc0ZBQU9DQVFFQXdBVEdacGdrejg0ckJkbnlBVUUyZUpEMFIwUnNLUlZaYXJHcVlnV25ZYkxQWkZZNUpoL20KbVBHdzhaMC81SDREcEU0ZVlTSmxRU0pYclJWV29icjlmUzE3dXJpQlZxN2dUWG0yR2NJMUdFWWlFbE9EQVVhbgp6akJmRm9NTE5kNW94Mnh5cytaSkhzbEpsQTVzUTd4eTF5a1NqaUVXa1pFdXNuWGNjQ0h2VXBYYjFVM25tZzF6CkQvMDM3MWdxL3N1T0pmcHBlTVorRW43TmdZWjhVUmVuUEJFMzN2Rm1Sb0FEcUhZOFBKTUZEUm9aeEkrZmZjS0MKdzk5eGMxS0RiMnM3bmtzSG5yWDBBQStUQ1RENGhpWHNjNWp1T1EwaTc2L3NSNURiRnQvUisyT2RlT1pwSENpTApaS0YrYWl3MGt3clhnS3RZNnU2YzdPR2d6M0ZDV05VcGN3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
  }
}
